<% if staff_member.enabled? %>
  <div class="panel panel-default">
    <div class="panel-heading">
      <span>Add holiday</span>
    </div>
    <div class="panel-body">
      <%= render partial: 'shared/add_holiday_form', locals: { holiday: holiday, staff_member: staff_member } %>
    </div>
  </div>
<% end %>

<h2>Holidays</h2>

<% tax_year = TaxYear.new(Time.current.to_date) %>
<% holidays_this_year = HolidayInTaxYearQuery.new(
     relation: staff_member.active_holidays,
     tax_year: tax_year
    ).all.includes(:frozen_by) %>
<% estimated_accrued_holidays = AccruedHolidayEstimate.new(
      staff_member: staff_member,
      tax_year: tax_year
    ).call %>

<% if holidays_this_year.present? %>
  <% paid_days = holidays_this_year.paid.to_a.sum { |holiday| holiday.days } %>
  <% unpaid_days = holidays_this_year.unpaid.to_a.sum { |holiday| holiday.days } %>
  <p><%= pluralize(estimated_accrued_holidays, "Day") %> accrued this year (Estimated)</p>
  <p>Paid <%= pluralize(paid_days, 'Paid day') %> this year</p>
  <p><%= pluralize(unpaid_days, 'Unpaid day') %> this year</p>

  <%= render partial: 'shared/holidays_table', locals: { staff_member: staff_member, holidays: holidays_this_year } %>
<% else %>
  <div>No holidays this year</div>
<% end %>
