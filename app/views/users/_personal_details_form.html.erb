<%= form_for(user, url: update_personal_details_user_path(user), method: :post, html: { class: 'user-form' }) do |form| %>
  <%= form.fields_for(:name, (form.object.name || Name.new)) do |name_fields| %>
    <%= render partial: 'shared/name_fields', locals: { form: name_fields} %>
  <% end %>
  <%= form.fields_for(:email_address, (form.object.email_address || EmailAddress.new)) do |email_address_fields| %>
    <%= render partial: 'shared/email_address_fields', locals: { form: email_address_fields, required: true } %>
  <% end %>
  <%= form.submit('Update') %>
<% end %>
